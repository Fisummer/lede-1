From 61038c6b340414e3406709bb8a4968857f1b89d3 Mon Sep 17 00:00:00 2001
From: Syrone Wong <wong.syrone@gmail.com>
Date: Wed, 4 May 2016 11:15:58 +0800
Subject: [PATCH] rand

---
 src/local.c  | 4 ++--
 src/redir.c  | 3 +++
 src/tunnel.c | 4 ++++
 3 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/src/local.c b/src/local.c
index c3e4048..99d108e 100644
--- a/src/local.c
+++ b/src/local.c
@@ -31,6 +31,7 @@
 #include <signal.h>
 #include <string.h>
 #include <strings.h>
+#include <time.h>
 #include <unistd.h>
 #include <getopt.h>
 
@@ -985,6 +986,7 @@ int main(int argc, char **argv)
     char *iface      = NULL;
 
     srand(time(NULL));
+    rand();
 
     int remote_num = 0;
     ss_addr_t remote_addr[MAX_REMOTE_NUM];
@@ -1286,8 +1288,6 @@ int main(int argc, char **argv)
 
 int start_ss_local_server(profile_t profile)
 {
-    srand(time(NULL));
-
     char *remote_host = profile.remote_host;
     char *local_addr  = profile.local_addr;
     char *method      = profile.method;
diff --git a/src/redir.c b/src/redir.c
index 886daa2..61a7284 100644
--- a/src/redir.c
+++ b/src/redir.c
@@ -674,6 +674,9 @@ int main(int argc, char **argv)
     char *pid_path   = NULL;
     char *conf_path  = NULL;
 
+    srand(time(NULL));
+    rand();
+
     int remote_num = 0;
     ss_addr_t remote_addr[MAX_REMOTE_NUM];
     char *remote_port = NULL;
diff --git a/src/tunnel.c b/src/tunnel.c
index 304944c..8041070 100644
--- a/src/tunnel.c
+++ b/src/tunnel.c
@@ -27,6 +27,7 @@
 #include <signal.h>
 #include <string.h>
 #include <strings.h>
+#include <time.h>
 #include <unistd.h>
 #include <getopt.h>
 
@@ -696,6 +697,9 @@ int main(int argc, char **argv)
     char *conf_path  = NULL;
     char *iface      = NULL;
 
+    srand(time(NULL));
+    rand();
+
     int remote_num = 0;
     ss_addr_t remote_addr[MAX_REMOTE_NUM];
     char *remote_port = NULL;
